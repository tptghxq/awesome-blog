{% extends '__base__.html' %}

{% block title %}日志{% endblock %}

{% block beforehead %}

<script>
$(function(){
    var follow = new Vue({
        el:'#vm',
        data:{
                state:1,
                blogs:[],
                page:{},
                username:'{{__user__.name}}'
            },  
                ready:function (){
                     this.getBlogs();             
                },
        methods:{
            loadmore:function(){
                next = this.page.page_index+1;
                this.getBlogs(next);
            },
            turnstate:function(state){
                this.state=state;
                this.blogs=[];
                this.page={};
                this.getBlogs();
            },
            getBlogs:function(pageCode){
                pageCode=pageCode||1;
                if(this.state==1){
                    action='/api/gethotblogs'
                }
                else if (this.state==2){
                    action='/api/getnewblogs'
                }
                else if(this.state==3){
                    action='/api/getfocusblogs'
                }
                else if(this.state==4){
                    action='/api/getlikeblogs'
                }
                // var $navbutton = $(event.target);
                that=this;
                // $navbutton.addClass('disabled');
                    postJSON(action,{page:pageCode},function(err,r){
                        // $navbutton.removeClass('disabled');
                        if(err){showInfo(err)}
                        if(!err){
                                that.blogs=that.blogs.concat(r.blogs);
                                that.page=r.page;
                        }
                    });
            }
        }
    });
        $('#vm').show();
});

</script>

{% endblock %}

{% block content %}

    <div id="vm" class="blogsbox">
        <div class="subnav">
        <ul>
            <li><a :class="state==1?'active':''" href="javascript:void(0)" id="hot" v-on:click="turnstate(1)">热门</a></li>
            <li><a :class="state==2?'active':''" href="javascript:void(0)" id="thelast" v-on:click="turnstate(2)">最新</a></li>
            <li v-if="username&&{{__user__.following_num}}"><a :class="state==3?'active':''" href="javascript:void(0)" id="thefocus" v-on:click="turnstate(3)">关注</a></li>
            <li v-if="username"><a :class="state==4?'active':''" href="javascript:void(0)" id="newblogs" v-on:click="turnstate(4)">喜欢</a></li>
        </ul>
     </div>
       <div class="articles">
       <article class="articlebox" v-for="blog in blogs" track-by="id">
        <div>            
            <h2><a :href="'/blog/'+blog.id" v-text="blog.name" target="_blank"></a></h2>
            
           <div v-if="blog.summary" class="summary" v-html="blog.summary"></div>
           <p class="bloginfo"><a class="author fragment" :href="'/user/'+blog.user_name" target="_blank" v-text="blog.user_name"></a><span class="fragment"><i class="fa fa-heart gred"></i><span class="num" v-text="blog.like_num"></span></span><span class="fragment"><i class="fa fa-eye gred"></i><span class="num" v-text="blog.read_num"></span></span>
           <span class="fragment"><i class="uk-icon-comments gred"></i><span class="num" v-text="blog.review_num"></span></span><span class="time fragment" v-text="blog.created_at.toDateTime('MM月 dd yyyy')"></span></p> 
        </div>
        <img class="blogimg" v-if="blog.image" :src="blog.image" style="height:100px;width:100px">
        </article>
        <div class="loadmoreblogs" v-if="page.page_count&&page.page_index!=page.page_count" v-on:click="loadmore">加载更多</div>
        </div>
    </div>
{% endblock %}